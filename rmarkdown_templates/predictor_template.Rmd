---
title: "Predictor reserach"
author: "Shubila Balaile"
date: '2021-01-31'
output: html_document
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,output_file = "predictors.html", output_dir = "../paper") })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
# code for checking predictors
library(tidyverse)
library(summarytools)
library(sjlabelled)
library(kableExtra)

```


### Target population - lgbti labour force 


```{r target_pop, warning = FALSE}

# If we only have raw but no clean data then generate the clean data

if (file.exists("./data/clean/lgbti_sav.rds")){
  # do nothing
  print("Clean data already exist")
  
} else {
  
  source("./scripts/generate_clean_data.R")
         
}


# read both datasets in order to take variable labels from dta for use on sav

lgbti_sav <- readRDS("./data/clean/lgbti_sav.rds")
lgbti_dta <- readRDS("./data/clean/lgbti_dta.rds")

# extract variabel labels from the dta dataset and put them to the sav dataset

var_labs <- map_chr(lgbti_dta, ~ label(.))

lgbti_sav <- set_label(lgbti_sav,var_labs)

var_classes_sav <- map_chr(lgbti_sav, class)
var_classes_dta <- as.character(map_df(lgbti_dta, class)[3,])
names(var_classes_dta) <- names(var_classes_sav)

as.data.frame(table(var_classes_sav))%>%
  knitr::kable(., caption = "Variable types of sav format")%>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")

print(var_classes_sav[var_classes_sav == "numeric"])

as.data.frame(table(var_classes_dta))%>%
  knitr::kable(.,caption = "Variable types of dta format")%>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")

print(var_classes_dta[var_classes_dta == "numeric"])

print(
  ctable(
    y = lgbti_sav$open_at_work,
    x = lgbti_sav$RESPONDENT_CATEGORY,
    cumul = FALSE,
    headings = FALSE
  ),
  big.mark = " ",
  decimal.mark = ".",
  method = "render"
)

 

```

### Summary of section A variables in the dataset *filtered* for the non-missing values of open_at_work


```{r section_a, warning = FALSE}

# list the administrative variables which should be excluded


section_a <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((A1:A14)) 

  print(
    dfSummary(
      section_a,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

### Summary of section TR variables in the dataset *filtered* for non missing values of open_at_work


```{r section_tr, warning = FALSE}
# list the administrative variables which should be excluded


section_tr <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((TR1:TR8_2_11))

  print(
    dfSummary(
      section_tr,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```


### Summary of section IX variables in the dataset *filtered* for non missing values of open_at_work


```{r section_ix, warning = FALSE}
# list the administrative variables which should be excluded


section_ix <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
   select((IX1_A:IX9_K))

  print(
    dfSummary(
      section_ix,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```



### Summary of section B variables in the dataset *filtered* for non missing values of open_at_work


```{r section_b, warning = FALSE}
# list the administrative variables which should be excluded


section_b <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((B1:B5))  

  print(
    dfSummary(
      section_b,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

### Summary of section C variables in the dataset *filtered* for non missing values of open_at_work


```{r section_c, warning = FALSE}
# list the administrative variables which should be excluded


section_c <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((C1_A:C13_C))

  print(
    dfSummary(
      section_c,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

### Summary of section D variables in the dataset *filtered* for non missing values of open_at_work


```{r section_d, warning = FALSE}
# list the administrative variables which should be excluded


section_d <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((D1:D4))
   

  print(
    dfSummary(
      section_d,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```
### Summary of section E variables in the dataset *filtered* for non missing values of open_at_work


```{r section_e, warning = FALSE}
# list the administrative variables which should be excluded


section_e <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((E1:E11_G))

  print(
    dfSummary(
      section_e,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

### Summary of section F variables in the dataset *filtered* for non missing values of open_at_work


```{r section_f, warning = FALSE}
# list the administrative variables which should be excluded


section_f <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((F1_A:F10_L))

  print(
    dfSummary(
      section_f,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```


### Summary of section G variables in the dataset *filtered* for non missing values of open_at_work


```{r section_g, warning = FALSE}
# list the administrative variables which should be excluded


section_g <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((G1_A:G2))

  print(
    dfSummary(
      section_g,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

### Summary of section H variables in the dataset *filtered* for non missing values of open_at_work


```{r section_h, warning = FALSE}
# list the administrative variables which should be excluded


section_h <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((H1:H23_I ))

  print(
    dfSummary(
      section_h,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

### Summary of section I variables in the dataset *filtered* for non missing values of open_at_work


```{r section_i, warning = FALSE}

# list the administrative variables which should be excluded


section_i <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((I1_A:I3_E))

  print(
    dfSummary(
      section_i,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

### Summary of other variables in the dataset *filtered* for non missing values of open_at_work



```{r section_o, warning = FALSE}

# list the administrative variables which should be excluded


section_o <- lgbti_sav %>%
  filter(!is.na(open_at_work))%>%
  select((QST_TOTAL_DURATION:informed_consent))

  print(
    dfSummary(
      section_o,
      graph.magnif = 0.75,
      graph.col = TRUE,
      plain.ascii = FALSE,
      labels.col = TRUE,
      varnumbers = FALSE,
      na.col = TRUE,
      split.cells = 20
    ),
    method = 'render'
  )

```

